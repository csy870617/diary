<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="referrer" content="origin"> 
    
    <title>신앙일지 | Faith Log</title>
    <link rel="stylesheet" href="style.css?v=2.1">
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Pen+Script&family=Noto+Serif+KR:wght@300;400;600&family=Pretendard:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://apis.google.com/js/api.js"></script>
</head>
<body>
    <div class="layout" id="main-layout">
        <header class="brunch-header">
            <div class="header-left">
                <h1>Faith Log</h1>
                <span class="sub-logo">기록이 믿음이 되는 순간</span>
            </div>
            <div class="header-right">
                <div class="search-container" id="search-container">
                    <i class="ph ph-magnifying-glass" id="search-trigger"></i>
                    <input type="search" id="search-input" name="search_unique_query" autocomplete="off" readonly onfocus="this.removeAttribute('readonly');" placeholder="검색어를 입력하세요">
                </div>
                <div class="auth-area">
                    <div class="login-msg-wrapper" id="login-msg-area">
                        <span class="login-msg-main">여러 대의 기기에서 사용 시<br>구글 동기화 후 이용해 주세요.</span>
                    </div>
                    
                    <button id="refresh-btn" class="icon-nav-btn hidden" title="지금 동기화" style="margin-right: 4px;">
                        <i class="ph ph-arrows-clockwise"></i>
                    </button>

                    <button id="login-trigger-btn" class="login-btn-header">동기화</button>
                    <button id="logout-btn" class="login-btn-header hidden">로그아웃</button>
                </div>
            </div>
        </header>

        <div class="nav-row">
            <div class="tabs" id="tab-container"></div>
        </div>

        <div class="controls-row">
            <div class="nav-actions">
                <div class="sort-control">
                    <button id="sort-order-btn" class="icon-nav-btn" title="정렬 순서 변경">
                        <i class="ph ph-sort-descending" id="sort-icon"></i>
                    </button>
                    <select class="sort-select" id="sort-criteria">
                        <option value="created">최신순</option>
                        <option value="modified">수정순</option>
                        <option value="title">제목순</option>
                    </select>
                </div>
                <div class="divider-vertical"></div>
                <button class="icon-nav-btn trash" id="trash-btn" title="휴지통">
                    <i class="ph ph-trash"></i>
                </button>
            </div>
        </div>

        <main id="entry-list" class="entry-list"></main>

        <div class="floating-pen" id="write-btn">
            <i class="ph ph-pencil-simple"></i>
        </div>
    </div>

    <div id="write-modal" class="full-screen-modal hidden">
        <div class="write-header">
            <button id="close-write-btn" class="text-btn nav-back-btn">
                <i class="ph ph-caret-left"></i> <span id="back-btn-text">목록</span>
            </button>
            <div class="header-actions">
                <button id="btn-readonly" class="icon-action-btn" title="읽기 전용"><i class="ph ph-eye"></i></button>
                <button id="btn-bookmode" class="icon-action-btn" title="책 모드"><i class="ph ph-book-open"></i></button>
                <button id="btn-copy-text" class="icon-action-btn" title="내용 복사"><i class="ph ph-copy"></i></button>
            </div>
        </div>
        <div class="editor-toolbar" id="editor-toolbar">
            <div class="toolbar-content-scroll" id="toolbar-scroll-area">
                <div class="tool-group">
                    <button class="tool-btn" data-cmd="undo"><i class="ph ph-arrow-u-up-left"></i></button>
                    <button class="tool-btn" data-cmd="redo"><i class="ph ph-arrow-u-up-right"></i></button>
                </div>
                <div class="toolbar-divider"></div>
                <div class="tool-group">
                    <select id="font-selector" class="font-select">
                        <option value="Pretendard">고딕</option>
                        <option value="Noto Serif KR">명조</option>
                        <option value="Nanum Pen Script">손글씨</option>
                    </select>
                    <div class="font-size-controls">
                        <button class="tool-btn small" id="btn-global-size-down">가-</button>
                        <button class="tool-btn small" id="btn-global-size-up">가+</button>
                    </div>
                </div>
                <div class="toolbar-divider"></div>
                <div class="tool-group">
                    <button class="tool-btn" id="toolbar-color-btn"><i class="ph ph-palette" style="color:#F59E0B;"></i></button>
                    <button class="tool-btn" id="toolbar-hilite-btn"><i class="ph ph-highlighter" style="color:#FDE047;"></i></button>
                    
                    <button class="tool-btn" id="toolbar-image-btn"><i class="ph ph-image"></i></button>
                    <input type="file" id="image-upload-input" accept="image/*" style="display: none;">
                    
                    <button class="tool-btn" id="sticker-btn"><i class="ph ph-smiley"></i></button>
                </div>
                <div class="toolbar-divider"></div>
                <div class="tool-group">
                    <button class="tool-btn" data-cmd="bold"><i class="ph ph-text-b"></i></button>
                    <button class="tool-btn" data-cmd="italic"><i class="ph ph-text-italic"></i></button>
                    <button class="tool-btn" data-cmd="underline"><i class="ph ph-text-underline"></i></button>
                    <button class="tool-btn" data-cmd="strikeThrough"><i class="ph ph-text-strikethrough"></i></button>
                </div>
                <div class="toolbar-divider"></div>
                <div class="tool-group">
                    <button class="tool-btn" data-cmd="justifyLeft"><i class="ph ph-text-align-left"></i></button>
                    <button class="tool-btn" data-cmd="justifyCenter"><i class="ph ph-text-align-center"></i></button>
                    <button class="tool-btn" data-cmd="justifyRight"><i class="ph ph-text-align-right"></i></button>
                </div>
            </div>
            <button id="toolbar-toggle-btn" class="toolbar-toggle-btn"><i class="ph ph-caret-up"></i></button>
        </div>
        <div class="editor-container" id="editor-container">
            <div class="meta-info-row" id="meta-info-row">
                <span id="display-category" class="write-category"></span>
                <span id="display-date" class="write-date"></span>
            </div>
            <input type="text" id="edit-title" class="editor-title" placeholder="제목" autocomplete="off">
            <input type="text" id="edit-subtitle" class="editor-subtitle" placeholder="소제목" autocomplete="off">
            <div class="divider"></div>
            <div id="editor-body" class="editor-body" contenteditable="true" placeholder="이곳에 은혜를 기록하세요..."></div>
        </div>
        <div id="book-nav-left" class="book-nav prev hidden"><i class="ph ph-caret-left"></i></div>
        <div id="book-nav-right" class="book-nav next hidden"><i class="ph ph-caret-right"></i></div>
        <div id="page-indicator" class="page-indicator hidden"></div>
        <div id="sticker-palette" class="sticker-palette hidden"><div id="sticker-grid" class="sticker-grid"></div></div>
        
        <div id="color-palette-popup" class="color-palette-popup hidden">
            <div class="palette-header"><button class="color-remove-btn" id="btn-remove-color"><i class="ph ph-prohibit"></i> 색상 없음</button></div>
            <div class="color-grid">
                <button class="color-dot" style="background-color: #111827;" data-color="#111827"></button>
                <button class="color-dot" style="background-color: #EF4444;" data-color="#EF4444"></button>
                <button class="color-dot" style="background-color: #F97316;" data-color="#F97316"></button>
                <button class="color-dot" style="background-color: #F59E0B;" data-color="#F59E0B"></button>
                <button class="color-dot" style="background-color: #10B981;" data-color="#10B981"></button>
                <button class="color-dot" style="background-color: #3B82F6;" data-color="#3B82F6"></button>
                <button class="color-dot" style="background-color: #6366F1;" data-color="#6366F1"></button>
                <button class="color-dot" style="background-color: #8B5CF6;" data-color="#8B5CF6"></button>
                <button class="color-dot" style="background-color: #EC4899;" data-color="#EC4899"></button>
                <button class="color-dot" style="background-color: #6B7280;" data-color="#6B7280"></button>
                <button class="color-dot" style="background-color: #FEF08A;" data-color="#FEF08A"></button>
                <button class="color-dot" style="background-color: #BBF7D0;" data-color="#BBF7D0"></button>
                <button class="color-dot" style="background-color: #BFDBFE;" data-color="#BFDBFE"></button>
                <button class="color-dot" style="background-color: #E9D5FF;" data-color="#E9D5FF"></button>
                <button class="color-dot" style="background-color: #FBCFE8;" data-color="#FBCFE8"></button>
            </div>
        </div>
    </div>

    <div id="login-modal" class="full-screen-modal hidden">
        <button id="close-login-btn" class="btn-close-modal"><i class="ph ph-x"></i></button>
        <div class="login-wrapper">
            <div class="login-content">
                <div class="login-logo">
                    <h2>Faith Log</h2>
                    <p>구글 계정으로 동기화 시작</p>
                </div>
                <p style="font-size:14px; color:#666; margin-bottom:30px; line-height:1.6;">'FaithLog' 폴더에 데이터가 저장됩니다.<br>다른 기기에서도 구글 로그인만 하면<br>내 기록을 그대로 볼 수 있습니다.</p>
                <button id="google-login-btn" class="btn-login-submit" style="background:#4285F4; display:flex; align-items:center; justify-content:center; gap:10px;">
                   <i class="ph ph-google-logo" style="font-size:20px; color:white;"></i> 구글로 계속하기
                </button>
            </div>
        </div>
    </div>

    <div id="trash-modal" class="full-screen-modal hidden">
        <div class="write-header">
            <button id="close-trash-btn" class="text-btn nav-back-btn"><i class="ph ph-arrow-left"></i> 뒤로</button>
            <span style="font-weight:600; font-size:16px;">휴지통</span>
            <div style="width: 60px;"></div>
        </div>
        <div class="trash-container" id="trash-list"></div>
    </div>

    <div id="reset-pw-modal" class="modal-overlay hidden">
        <div class="simple-modal">
            <h3>비밀번호 재설정</h3>
            <p style="font-size:13px; color:#666; margin-bottom:15px;">가입한 이메일을 입력하세요.</p>
            <input type="email" id="reset-email" placeholder="email@example.com">
            <div class="modal-btns">
                <button id="send-reset-email-btn" class="primary-btn">전송</button>
                <button id="close-reset-btn" class="cancel-btn">닫기</button>
            </div>
        </div>
    </div>

    <div id="context-menu" class="context-menu hidden">
        <button id="ctx-move" class="ctx-item"><i class="ph ph-folder-notch"></i> 주제 이동</button>
        <button id="ctx-copy" class="ctx-item"><i class="ph ph-copy"></i> 복제</button>
        <div style="height:1px; background:#eee; margin:4px 0;"></div>
        <button id="ctx-delete" class="ctx-item danger"><i class="ph ph-trash"></i> 삭제</button>
    </div>
    <div id="category-context-menu" class="context-menu hidden">
        <button id="ctx-cat-rename" class="ctx-item"><i class="ph ph-pencil"></i> 이름 변경</button>
        <button id="ctx-cat-delete" class="ctx-item danger"><i class="ph ph-trash"></i> 주제 삭제</button>
    </div>
    <div id="move-modal" class="modal-overlay hidden">
        <div class="simple-modal" style="width: 280px;">
            <h3>주제 이동</h3>
            <div id="move-category-list" class="category-select-list"></div>
            <button id="close-move-btn" class="cancel-btn" style="width:100%;">취소</button>
        </div>
    </div>

    <script type="module" src="script.js?v=2.1"></script>
</body>
</html>